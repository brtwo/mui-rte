"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),Immutable=_interopDefault(require("immutable")),classNames=_interopDefault(require("classnames")),styles$6=require("@material-ui/core/styles"),Paper=_interopDefault(require("@material-ui/core/Paper")),draftJs=require("draft-js"),FormatBoldIcon=_interopDefault(require("@material-ui/icons/FormatBold")),FormatItalicIcon=_interopDefault(require("@material-ui/icons/FormatItalic")),FormatUnderlinedIcon=_interopDefault(require("@material-ui/icons/FormatUnderlined")),StrikethroughIcon=_interopDefault(require("@material-ui/icons/StrikethroughS")),HighlightIcon=_interopDefault(require("@material-ui/icons/Highlight")),TitleIcon=_interopDefault(require("@material-ui/icons/Title")),InsertLinkIcon=_interopDefault(require("@material-ui/icons/InsertLink")),PhotoLibraryIcon=_interopDefault(require("@material-ui/icons/PhotoLibrary")),FormatListNumberedIcon=_interopDefault(require("@material-ui/icons/FormatListNumbered")),FormatListBulletedIcon=_interopDefault(require("@material-ui/icons/FormatListBulleted")),FormatQuoteIcon=_interopDefault(require("@material-ui/icons/FormatQuote")),CodeIcon=_interopDefault(require("@material-ui/icons/Code")),FormatClearIcon=_interopDefault(require("@material-ui/icons/FormatClear")),SaveIcon=_interopDefault(require("@material-ui/icons/Save")),UndoIcon=_interopDefault(require("@material-ui/icons/Undo")),RedoIcon=_interopDefault(require("@material-ui/icons/Redo")),IconButton=_interopDefault(require("@material-ui/core/IconButton")),MuiLink=_interopDefault(require("@material-ui/core/Link")),Button=_interopDefault(require("@material-ui/core/Button")),Grid=_interopDefault(require("@material-ui/core/Grid")),Popover=_interopDefault(require("@material-ui/core/Popover")),TextField=_interopDefault(require("@material-ui/core/TextField")),ButtonGroup=_interopDefault(require("@material-ui/core/ButtonGroup")),InsertPhotoIcon=_interopDefault(require("@material-ui/icons/InsertPhoto")),MovieIcon=_interopDefault(require("@material-ui/icons/Movie")),CheckIcon=_interopDefault(require("@material-ui/icons/Check")),DeleteIcon=_interopDefault(require("@material-ui/icons/DeleteOutline")),FormatAlignCenter=_interopDefault(require("@material-ui/icons/FormatAlignCenter")),FormatAlignLeft=_interopDefault(require("@material-ui/icons/FormatAlignLeft")),FormatAlignRight=_interopDefault(require("@material-ui/icons/FormatAlignRight")),List=_interopDefault(require("@material-ui/core/List")),ListItem=_interopDefault(require("@material-ui/core/ListItem")),__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},ToolbarButton=function(t){var e=t.inlineMode?"small":t.size||"medium",n=t.inlineMode?"-toolbar":"",r=(t.editorId||"mui-rte")+"-"+(t.id||t.label)+"-button"+n,n={id:r,onMouseDown:function(e){e.preventDefault(),t.onClick&&t.onClick(t.style,t.type,r,t.inlineMode)},disabled:t.disabled||!1};return t.icon?React__default.createElement(IconButton,__assign({},n,{"aria-label":t.label,color:t.active?"primary":"default",size:e}),t.icon):t.component?React__default.createElement(t.component,__assign({},n,{active:t.active||!1})):null},getSelectionInfo=function(e){var t=e.getSelection(),n=t.getStartOffset(),r=e.getCurrentContent(),t=r.getBlockForKey(t.getStartKey()),e=e.getCurrentInlineStyle(),n=t.getEntityAt(n),o="";return n&&(o=r.getEntity(n).getType()),{inlineStyle:e,blockType:t.getType(),entityType:o,linkKey:n,block:t}},removeBlockFromMap=function(e,t){var e=e.getCurrentContent(),n=draftJs.Modifier.removeRange(e,new draftJs.SelectionState({anchorKey:t.getKey(),anchorOffset:0,focusKey:t.getKey(),focusOffset:t.getLength()}),"backward"),t=n.getBlockMap().delete(t.getKey());return n.merge({blockMap:t,selectionAfter:e.getSelectionAfter()})},atomicBlockExists=function(t,e){if(e)return e.find(function(e){return"atomic"===e.type&&e.name===t&&void 0!==e.atomicComponent})},isGreaterThan=function(e,t){return!!t&&t<e},clearInlineStyles=function(n,e){var t=["BOLD","ITALIC","UNDERLINE"];return(t=e?t.concat(Object.getOwnPropertyNames(e)):t).reduce(function(e,t){return draftJs.Modifier.removeInlineStyle(e,n.getSelection(),t)},n.getCurrentContent())},getEditorBounds=function(e){var t=draftJs.getVisibleSelectionRect(window);return{selectionRect:t?{top:null==t?void 0:t.top,left:null==t?void 0:t.left}:null,editorRect:e.getBoundingClientRect()}},getLineNumber=function(e){var t=e.getSelection().getStartKey();return e.getCurrentContent().getBlockMap().keySeq().findIndex(function(e){return e===t})},STYLE_TYPES=[{label:"H2",name:"title",style:"header-two",icon:React__default.createElement(TitleIcon,null),type:"block"},{label:"Bold",name:"bold",style:"BOLD",icon:React__default.createElement(FormatBoldIcon,null),type:"inline"},{label:"Italic",name:"italic",style:"ITALIC",icon:React__default.createElement(FormatItalicIcon,null),type:"inline"},{label:"Underline",name:"underline",style:"UNDERLINE",icon:React__default.createElement(FormatUnderlinedIcon,null),type:"inline"},{label:"Strikethrough",name:"strikethrough",style:"STRIKETHROUGH",icon:React__default.createElement(StrikethroughIcon,null),type:"inline"},{label:"Highlight",name:"highlight",style:"HIGHLIGHT",icon:React__default.createElement(HighlightIcon,null),type:"inline"},{label:"Undo",name:"undo",style:"UNDO",icon:React__default.createElement(UndoIcon,null),type:"callback"},{label:"Redo",name:"redo",style:"REDO",icon:React__default.createElement(RedoIcon,null),type:"callback"},{label:"Link",name:"link",style:"LINK",icon:React__default.createElement(InsertLinkIcon,null),type:"callback",id:"link-control"},{label:"Media",name:"media",style:"IMAGE",icon:React__default.createElement(PhotoLibraryIcon,null),type:"callback",id:"media-control"},{label:"UL",name:"bulletList",style:"unordered-list-item",icon:React__default.createElement(FormatListBulletedIcon,null),type:"block"},{label:"OL",name:"numberList",style:"ordered-list-item",icon:React__default.createElement(FormatListNumberedIcon,null),type:"block"},{label:"Blockquote",name:"quote",style:"blockquote",icon:React__default.createElement(FormatQuoteIcon,null),type:"block"},{label:"Code Block",name:"code",style:"code-block",icon:React__default.createElement(CodeIcon,null),type:"block"},{label:"Clear",name:"clear",style:"clear",icon:React__default.createElement(FormatClearIcon,null),type:"callback"},{label:"Save",name:"save",style:"save",icon:React__default.createElement(SaveIcon,null),type:"callback"}],Toolbar=function(o){var e=React.useState(o.controls?[]:STYLE_TYPES),t=e[0],r=e[1],a=o.editorState,e=o.inlineMode?"-inline-toolbar":"-toolbar";return React.useEffect(function(){var n;o.controls&&(n=[],o.controls.filter(function(e,t){return o.controls.indexOf(e)>=t}).forEach(function(t){var e=STYLE_TYPES.find(function(e){return e.name===t});e?n.push(e):o.customControls&&(e=o.customControls.find(function(e){return e.name===t}))&&"atomic"!==e.type&&(e.icon||e.component)&&n.push({id:e.id||e.name+"Id",name:e.name,label:e.name,style:e.name.toUpperCase(),icon:e.icon,component:e.component,type:e.type,clickFnName:"onCustomClick"})}),r(n))},[o.controls,o.customControls]),React__default.createElement("div",{id:o.id+e,className:o.className},t.map(function(e){var t,n,r;return o.inlineMode&&"inline"!==e.type&&"link"!==e.name&&"clear"!==e.name?null:(t=!1,n=o.onClick,o.isActive?"inline"===e.type?t=a.getCurrentInlineStyle().has(e.style):"block"===e.type?(r=a.getSelection(),(r=a.getCurrentContent().getBlockForKey(r.getStartKey()))&&(t=e.style===r.getType())):"IMAGE"!==e.style&&"LINK"!==e.style||(t=e.style===getSelectionInfo(a).entityType):t=!1,React__default.createElement(ToolbarButton,{id:e.id,editorId:o.id,key:"key-"+e.label,active:t,label:e.label,onClick:n,style:e.style,type:e.type,icon:e.icon,component:e.component,inlineMode:o.inlineMode,disabled:o.disabled,size:o.size}))}))},Link=function(e){var t=e.contentState.getEntity(e.entityKey).getData(),n=t.url,t=t.className;return React__default.createElement(MuiLink,{href:n,className:t+" editor-anchor",target:"_blank"},e.children)},styles=function(e){e=e.shadows;return styles$6.createStyles({root:{margin:"5px 0 1px",outline:"none"},editable:{cursor:"pointer","&:hover":{boxShadow:e[3]}},focused:{boxShadow:e[3]},centered:{textAlign:"center"},leftAligned:{textAlign:"left"},rightAligned:{textAlign:"right"}})},Media=function(e){var t,n=e.contentState.getEntity(e.block.getEntityAt(0)).getData(),r=n.url,o=n.width,a=n.height,i=n.alignment,n=n.type,l=e.blockProps,c=l.onClick,u=l.readOnly,l=l.focusKey;return React__default.createElement("div",{className:classNames(((t={})[e.classes.centered]="center"===i,t[e.classes.leftAligned]="left"===i,t[e.classes.rightAligned]="right"===i,t))},(i={src:r,className:classNames(e.classes.root,((i={})[e.classes.editable]=!u,i[e.classes.focused]=!u&&l===e.block.getKey(),i)),width:o,height:"video"===n?"auto":a,onClick:function(){u||c(e.block)}},n&&"image"!==n?"video"===n?React__default.createElement("video",__assign({},i,{autoPlay:!1,controls:!0})):null:React__default.createElement("img",__assign({},i))))},Media$1=styles$6.withStyles(styles,{withTheme:!0})(Media),styles$1=function(e){e=e.palette;return styles$6.createStyles({root:{fontStyle:"italic",color:e.grey[800],borderLeft:"4px solid "+e.grey.A100}})},Blockquote=function(e){return React__default.createElement("div",{className:e.classes.root},e.children)},Blockquote$1=styles$6.withStyles(styles$1,{withTheme:!0})(Blockquote),styles$2=function(e){var t=e.spacing,e=e.palette;return styles$6.createStyles({root:{backgroundColor:e.grey[200],padding:t(1,2,1,2)}})},CodeBlock=function(e){return React__default.createElement("div",{className:e.classes.root},e.children)},CodeBlock$1=styles$6.withStyles(styles$2,{withTheme:!0})(CodeBlock),styles$3=function(e){e=e.spacing;return styles$6.createStyles({linkPopover:{padding:e(2,2,2,2),maxWidth:250},linkTextField:{width:"100%"}})},UrlPopover=function(e){function t(e,t){var n;""===e?o(__assign(__assign({},r),((n={})[t]=void 0,n))):(n=parseInt(e,10),isNaN(n)||o(__assign(__assign({},r),((e={})[t]=n,e))))}var n=React.useState(e.data||{url:void 0,width:void 0,height:void 0,alignment:void 0,type:void 0}),r=n[0],o=n[1],n=e.classes;return React__default.createElement(Popover,{open:void 0!==e.anchor,anchorEl:e.anchor,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},React__default.createElement("div",{className:n.linkPopover},React__default.createElement(Grid,{container:!0,spacing:1},React__default.createElement(Grid,{container:!0,item:!0,xs:!0,spacing:1},React__default.createElement(Grid,{item:!0,xs:12},React__default.createElement(TextField,{className:n.linkTextField,onChange:function(e){return o(__assign(__assign({},r),{url:e.target.value}))},label:"URL",defaultValue:e.data&&e.data.url,autoFocus:!0,InputLabelProps:{shrink:!0}})),e.isMedia?React__default.createElement(React__default.Fragment,null,React__default.createElement(Grid,{item:!0,xs:12},React__default.createElement(ButtonGroup,{fullWidth:!0},React__default.createElement(Button,{color:r.type&&"image"!==r.type?"default":"primary",size:"small",onClick:function(){return o(__assign(__assign({},r),{type:"image"}))}},React__default.createElement(InsertPhotoIcon,null)),React__default.createElement(Button,{color:"video"===r.type?"primary":"default",size:"small",onClick:function(){return o(__assign(__assign({},r),{type:"video"}))}},React__default.createElement(MovieIcon,null)))),React__default.createElement(Grid,{item:!0,xs:6},React__default.createElement(TextField,{onChange:function(e){return t(e.target.value,"width")},value:r.width||"",label:"Width",InputLabelProps:{shrink:!0}})),React__default.createElement(Grid,{item:!0,xs:6},React__default.createElement(TextField,{onChange:function(e){return t(e.target.value,"height")},value:r.height||"",label:"Height",InputLabelProps:{shrink:!0}})),React__default.createElement(Grid,{item:!0,xs:12},React__default.createElement(ButtonGroup,{fullWidth:!0},React__default.createElement(Button,{color:"left"===r.alignment?"primary":"default",size:"small",onClick:function(){return o(__assign(__assign({},r),{alignment:"left"}))}},React__default.createElement(FormatAlignLeft,null)),React__default.createElement(Button,{color:"center"===r.alignment?"primary":"default",size:"small",onClick:function(){return o(__assign(__assign({},r),{alignment:"center"}))}},React__default.createElement(FormatAlignCenter,null)),React__default.createElement(Button,{color:"right"===r.alignment?"primary":"default",size:"small",onClick:function(){return o(__assign(__assign({},r),{alignment:"right"}))}},React__default.createElement(FormatAlignRight,null))))):null),React__default.createElement(Grid,{container:!0,item:!0,xs:12,direction:"row",justify:"flex-end"},e.data&&e.data.url?React__default.createElement(Button,{onClick:function(){return e.onConfirm(e.isMedia,"")}},React__default.createElement(DeleteIcon,null)):null,React__default.createElement(Button,{onClick:function(){return e.onConfirm(e.isMedia,r.url,r.width,r.height,r.alignment,r.type)}},React__default.createElement(CheckIcon,null))))))},UrlPopover$1=styles$6.withStyles(styles$3,{withTheme:!0})(UrlPopover),styles$4=function(){return styles$6.createStyles({container:{minWidth:"200px",position:"absolute",zIndex:10},item:{cursor:"pointer"}})},Autocomplete=function(n){var r;return n.items.length?(r=n.classes,React__default.createElement(Paper,{className:r.container,style:{top:n.top,left:n.left}},React__default.createElement(List,{dense:!0},n.items.map(function(e,t){return React__default.createElement(ListItem,{key:t,className:r.item,selected:t===n.selectedIndex,onClick:function(){return n.onClick(t)}},e.content)})))):null},Autocomplete$1=styles$6.withStyles(styles$4,{withTheme:!0})(Autocomplete),styles$5=function(e){var t=e.spacing,n=e.typography,e=e.palette;return styles$6.createStyles({root:{},container:{margin:t(1,0,0,0),position:"relative",fontFamily:n.body1.fontFamily,fontSize:n.body1.fontSize,"& figure":{margin:0}},inheritFontSize:{fontSize:"inherit"},editor:{},editorContainer:{margin:t(1,0,0,0),cursor:"text",width:"100%",padding:t(0,0,1,0)},editorReadOnly:{borderBottom:"none"},error:{borderBottom:"2px solid red"},hidePlaceholder:{display:"none"},placeHolder:{color:e.grey[600],position:"absolute",outline:"none"},linkPopover:{padding:t(2,2,2,2)},linkTextField:{width:"100%"},anchorLink:{},toolbar:{},inlineToolbar:{maxWidth:"180px",position:"absolute",padding:"5px",zIndex:10}})},blockRenderMap=Immutable.Map({blockquote:{element:"blockquote",wrapper:React__default.createElement(Blockquote$1,null)},"code-block":{element:"pre",wrapper:React__default.createElement(CodeBlock$1,null)}}),styleRenderMap={STRIKETHROUGH:{textDecoration:"line-through"},HIGHLIGHT:{backgroundColor:"yellow"}},hasCommandModifier=draftJs.KeyBindingUtil.hasCommandModifier,autocompleteMinSearchCharCount=0,lineHeight=26,defaultInlineToolbarControls=["bold","italic","underline","clear"],findLinkEntities=function(e,t,n){e.findEntityRanges(function(e){e=e.getEntity();return null!==e&&"LINK"===n.getEntity(e).getType()},t)},findDecoWithRegex=function(e,t,n){for(var r,o,a=t.getText();null!==(r=e.exec(a));)n(o=r.index,o+r[0].length)},useEditorState=function(e){var t=[{strategy:findLinkEntities,component:Link}],n=(e.decorators&&e.decorators.forEach(function(n){return t.push({strategy:function(e,t){findDecoWithRegex(n.regex,e,t)},component:n.component})}),new draftJs.CompositeDecorator(t)),e=e.defaultValue||e.value;return e?draftJs.EditorState.createWithContent(draftJs.convertFromRaw(JSON.parse(e)),n):draftJs.EditorState.createEmpty(n)},MUIRichTextEditor=function(d,e){function n(e){e=e.target.nodeName,I(),"IMG"!==e&&"VIDEO"!==e&&setTimeout(function(){var e=h.current.getSelection();if(e.isCollapsed()||void 0!==H&&S.current.start===e.getStartOffset()&&S.current.end===e.getEndOffset())return"IMAGE"===(n=getSelectionInfo(h.current)).entityType?void re(n.block):void a(__assign(__assign({},u),{toolbarPosition:void 0}));S.current={start:e.getStartOffset(),end:e.getEndOffset()};var t,n,e=null==(n=y.current)?void 0:n.editor;e&&(t=(n=getEditorBounds(e)).editorRect,n=n.selectionRect)&&(e={top:e.offsetTop-48+(n.top-t.top),left:e.offsetLeft+(n.left-t.left)},a(__assign(__assign({},u),{toolbarPosition:e})))},1)}function w(e){var t,n,r,e=e||f,o=T();o.length>e&&(o=o[e],t=(e=E.current).getFocusOffset()+l.length+1,e=e.merge({focusOffset:t}),v.current.atomicBlockName?(t=t=v.current.atomicBlockName,n=e,r=o.value,atomicBlockExists(t,d.customControls)&&(n=draftJs.Modifier.removeRange(h.current.getCurrentContent(),n,"forward"),n=draftJs.EditorState.push(h.current,n,"remove-range"),t=F(n,t.toUpperCase(),{value:r},{selection:n.getCurrentContent().getSelectionAfter()}),B(t))):(r=e,n=o.value,t=g.getCurrentContent().createEntity("AC_ITEM","IMMUTABLE").getLastCreatedEntityKey(),r=draftJs.Modifier.replaceText(h.current.getCurrentContent(),r,n,h.current.getCurrentInlineStyle(),t),n=draftJs.EditorState.push(h.current,r,"insert-characters"),!1===v.current.insertSpaceAfter?B(n):(t=draftJs.Modifier.insertText(n.getCurrentContent(),n.getSelection()," ",n.getCurrentInlineStyle()),B(draftJs.EditorState.push(n,t,"insert-characters"))))),P()}function P(){I(),m(0),x()}function J(e,t,n,r){var o,a;if("inline"===t)p(draftJs.RichUtils.toggleInlineStyle(g,e));else if("block"===t)p(draftJs.RichUtils.toggleBlockType(g,e));else switch(e){case"UNDO":p(draftJs.EditorState.undo(g));break;case"REDO":p(draftJs.EditorState.redo(g));break;case"LINK":a=r,g.getSelection().isCollapsed()||X(g,"link",a);break;case"IMAGE":Z(r);break;case"clear":void 0!==b.current&&(a=clearInlineStyles(g,b.current),o=getSelectionInfo(g),a=draftJs.EditorState.push(g,a,"change-inline-style"),p(draftJs.RichUtils.toggleBlockType(a,o.blockType)));break;case"save":j();break;default:var i=e,l=n;if(d.customControls)for(var c=0,u=d.customControls;c<u.length;c++){var s=u[c];if(s.name.toUpperCase()===i){s.onClick&&(setTimeout(function(){var e;return null==(e=y.current)?void 0:e.blur()},0),(s=s.onClick(g,s.name,document.getElementById(l)))?(s.getSelection().isCollapsed()?p:M)(s):g.getSelection().isCollapsed()||x());break}}return}}function i(e,t){return e=e.getCurrentContent().getPlainText("").length,isGreaterThan(e+t,d.maxLength)?"handled":"not-handled"}var t,r,c=d.classes,U=d.controls,q=d.customControls,o=React.useState({}),u=o[0],a=o[1],o=React.useState(!1),O=o[0],K=o[1],o=React.useState(""),l=o[0],s=o[1],o=React.useState(0),f=o[0],m=o[1],o=React.useState(function(){return useEditorState(d)}),g=o[0],p=o[1],o=React.useState(""),$=o[0],G=o[1],y=React.useRef(null),_=d.id||"mui-rte",H=React.useRef(void 0),h=React.useRef(g),v=React.useRef(void 0),E=React.useRef(void 0),C=React.useRef(void 0),R=d.autocomplete&&d.autocomplete.suggestLimit||5,z=React.useRef(!0),o=React.useRef(void 0),b=React.useRef(void 0),k=React.useRef(!1),S=React.useRef({start:0,end:0}),I=(React.useImperativeHandle(e,function(){return{focus:function(){L()},save:function(){j()},insertAtomicBlock:function(e,t){Y(e,t)},insertAtomicBlockSync:function(e,t){Y(e,t)},insertAtomicBlockAsync:function(e,t,n){V(e,t,n)}}}),React.useEffect(function(){var e=useEditorState(d);return p(e),ee(!0),function(){ee()}},[d.value,d.defaultValue]),React.useEffect(function(){d.onChange&&d.onChange(g),h.current=g},[g]),React.useEffect(function(){H.current=u.toolbarPosition},[u.toolbarPosition]),React.useEffect(function(){l.length<autocompleteMinSearchCharCount&&m(0)},[l]),function(){s(""),C.current=void 0,E.current=void 0}),T=function(){return l.length<autocompleteMinSearchCharCount?[]:v.current.items.filter(function(e){return 0<e.keys.filter(function(e){return e.includes(l)}).length}).splice(0,R)},B=function(e){p(e)},L=function(){W(),d.onFocus&&d.onFocus()},W=function(){K(!0),setTimeout(function(){var e;return null==(e=y.current)?void 0:e.focus()},0)},j=function(){d.onSave&&d.onSave(JSON.stringify(draftJs.convertToRaw(g.getCurrentContent())))},Y=function(e,t){var e=atomicBlockExists(e,d.customControls);e&&(e=F(g,e.name.toUpperCase(),t,{selection:g.getCurrentContent().getSelectionAfter()}),M(e))},V=function(t,e,n){var n=Q(t,n),r=n.getFocusOffset()+1,o=n.merge({focusOffset:r});e.then(function(e){e=F(h.current,t,e.data,{selection:o});B(e)}).catch(function(e){e||(e=draftJs.Modifier.removeRange(h.current.getCurrentContent(),o,"forward"),B(draftJs.EditorState.push(h.current,e,"remove-range")))})},Q=function(e,t){var t=t||e+"...",e=h.current.getCurrentContent(),n=e.createEntity("ASYNC_ATOMICBLOCK","IMMUTABLE").getLastCreatedEntityKey(),t=draftJs.Modifier.insertText(h.current.getCurrentContent(),e.getSelectionAfter(),t,void 0,n),n=e.getSelectionAfter(),e=draftJs.EditorState.push(h.current,t,"insert-characters");return B(e),n},X=function(e,t,n){var r=getSelectionInfo(e),e=e.getCurrentContent(),r=r.linkKey,o=void 0;r&&(o=e.getEntity(r).getData()),a({urlData:o,urlKey:r,toolbarPosition:n?u.toolbarPosition:void 0,anchorUrlPopover:n?document.getElementById(_+"-"+t+"-control-button-toolbar"):document.getElementById(_+"-"+t+"-control-button"),urlIsMedia:"media"===t||void 0})},Z=function(e,t){X(t||g,"media",e)},ee=function(e){void 0===e&&(e=!1);var t=null==(t=y.current)?void 0:t.editor;t&&(t.removeEventListener("mouseup",n),e)&&t.addEventListener("mouseup",n)},te=function(){var e=g.getSelection();p(draftJs.RichUtils.toggleLink(g,e,null))},ne=function(){var e=g.getSelection().getStartKey(),e=g.getCurrentContent().getBlockForKey(e),e=removeBlockFromMap(g,e),e=draftJs.EditorState.push(g,e,"remove-range");p(e)},M=function(e){p(e),D()},D=function(){x(),a(__assign(__assign({},u),{anchorUrlPopover:void 0,urlKey:void 0,urlIsMedia:void 0,urlData:void 0}))},x=function(){setTimeout(function(){var e;return null==(e=y.current)?void 0:e.blur()},0),setTimeout(function(){var e;return null==(e=y.current)?void 0:e.focus()},1)},re=function(e){var t=draftJs.SelectionState.createEmpty(e.getKey()),t=draftJs.EditorState.forceSelection(h.current,t);h.current=t,G(e.getKey()),p(t),Z(!1,t)},oe=function(){var e,t=JSON.parse(JSON.stringify(styleRenderMap));null!=(e=d.customControls)&&e.filter(function(e){return"inline"===e.type&&e.inlineStyle}).forEach(function(e){t[e.name.toUpperCase()]=e.inlineStyle}),b.current=t},F=function(e,t,n,r){t=e.getCurrentContent().createEntity(t,"IMMUTABLE",n),n=t.getLastCreatedEntityKey(),e=draftJs.EditorState.set(e,__assign({currentContent:t},r));return draftJs.AtomicBlockUtils.insertAtomicBlock(e,n," ")},e=void 0===d.toolbar||d.toolbar,A=d.inlineToolbarControls||defaultInlineToolbarControls,N=void 0===d.readOnly||!d.readOnly,ae="",ie=null;return O||g.getCurrentContent().hasText()||(ie=React__default.createElement("div",{className:classNames(c.editorContainer,c.placeHolder,((t={})[c.error]=d.error,t)),tabIndex:0,onFocus:function(){!1===z.current?W():(L(),z.current=!1)}},d.label||""),ae=c.hidePlaceholder),React__default.createElement("div",{id:_+"-root",className:c.root},React__default.createElement("div",{id:_+"-container",className:classNames(c.container,((t={})[c.inheritFontSize]=d.inheritFontSize,t))},d.autocomplete&&C.current?React__default.createElement(Autocomplete$1,{items:T(),top:C.current.top,left:C.current.left,onClick:w,selectedIndex:f}):null,d.inlineToolbar&&N&&u.toolbarPosition?React__default.createElement(Paper,{className:c.inlineToolbar,style:{top:u.toolbarPosition.top,left:u.toolbarPosition.left}},React__default.createElement(Toolbar,{id:_,editorState:g,onClick:J,controls:A,customControls:q,inlineMode:!0,isActive:!0})):null,e?React__default.createElement(Toolbar,{id:_,editorState:g,onClick:J,controls:U,customControls:q,className:c.toolbar,disabled:!N,size:d.toolbarButtonSize,isActive:O}):null,ie,React__default.createElement("div",{id:_+"-editor",className:c.editor},React__default.createElement("div",{id:_+"-editor-container",className:classNames(ae,c.editorContainer,((t={})[c.editorReadOnly]=!N,t[c.error]=d.error,t)),onMouseDown:function(){k.current=!0},onBlur:function(){k.current=!1,K(!1),d.onBlur&&d.onBlur(),u.anchorUrlPopover||a(__assign(__assign({},u),{toolbarPosition:void 0}))}},React__default.createElement(draftJs.Editor,__assign({blockRenderMap:(void 0===o.current&&(r={},null!=(A=d.customControls)&&A.filter(function(e){return"block"===e.type&&e.blockWrapper}).forEach(function(e){r[e.name.toUpperCase()]={element:"div",wrapper:e.blockWrapper}}),o.current=draftJs.DefaultDraftBlockRenderMap.merge(blockRenderMap,Immutable.Map(r))),o.current),blockRendererFn:function(e){if("atomic"===e.getType()){var t=g.getCurrentContent(),n=e.getEntityAt(0);if(n){n=t.getEntity(n).getType();if("IMAGE"===n)return{component:Media$1,editable:!1,props:{onClick:re,readOnly:d.readOnly,focusKey:$}};n=atomicBlockExists(n.toLowerCase(),d.customControls);if(n)return{component:n.atomicComponent,editable:!1,props:t.getEntity(e.getEntityAt(0)).getData()}}}return null},customStyleFn:function(e){void 0===b.current&&oe();var n=b.current;return e.toJS().reduce(function(e,t){return n[t]},{})},editorState:g,onChange:B,onFocus:function(){var e;L(),!0===k.current?k.current=!1:(e=draftJs.EditorState.forceSelection(g,g.getSelection()),setTimeout(function(){return p(draftJs.EditorState.moveFocusToEnd(e))},0))},readOnly:d.readOnly,handleKeyCommand:function(t,e){var n=draftJs.RichUtils.handleKeyCommand(e,t);if(n)return B(n),"handled";if(t.includes("mui-autocomplete"))return"mui-autocomplete-insert"===t&&w(),"mui-autocomplete-end"===t&&P(),"handled";if(d.keyCommands){var n=d.keyCommands.find(function(e){return e.name===t});if(n)return n=n.callback(e),B(n),"handled"}return"not-handled"},handleBeforeInput:function(e,t){var n,r,o,a;return" "===e&&l.length?I():E.current?s(l+e):(a=e,(e=d.autocomplete&&(e=d.autocomplete.strategies.filter(function(e){return e.triggerChar===a})).length?e[0]:void 0)&&(v.current=e,e=null==(e=y.current)?void 0:e.editor)&&(n=(r=getEditorBounds(e)).editorRect,r=r.selectionRect,o=getLineNumber(g),o=r?r.top:n.top+lineHeight*o,r=(r||n).left,o={top:e.offsetTop+(o-n.top)+lineHeight,left:e.offsetLeft+(r-n.left)},E.current||(E.current=h.current.getSelection()),C.current=o)),i(t,1)},handlePastedText:function(e,t,n){return i(n,e.length)},handleReturn:function(e,t){return i(t,1)},keyBindingFn:function(t){if(hasCommandModifier(t)&&d.keyCommands){var e=d.keyCommands.find(function(e){return e.key===t.keyCode});if(e)return e.name}if(l){e=function(e){var t=T().length,n=t<R?t:R;switch(e.key){case"ArrowDown":return m(0===f&&1===t||f+1===n?0:f+1<n?f+1:f),"mui-autocomplete-navigate";case"ArrowUp":return m(f?f-1:n-1),"mui-autocomplete-navigate";case"Enter":return"mui-autocomplete-insert";case"Escape":return"mui-autocomplete-end";default:return null}}(t);if(e)return e}var n,r,e=draftJs.getDefaultKeyBinding(t);return n=e,r=h.current.getCurrentContent().getLastBlock().getText(),"backspace"===n&&v.current&&r.substr(r.length-1)===v.current.triggerChar?I():C.current&&"backspace"===n&&l.length?s(l.substr(0,l.length-1)):C.current||"backspace"!==n&&"split-block"!==n||I(),e},ref:y},d.draftEditorProps)))),u.anchorUrlPopover?React__default.createElement(UrlPopover$1,{data:u.urlData,anchor:u.anchorUrlPopover,onConfirm:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(e?function(e,t,n,r,o){var a=u.urlKey,i,l,c,c;e?(i=g.getCurrentContent(),l={url:e,width:t,height:n,alignment:r,type:o},c=a?(i.replaceEntityData(a,l),draftJs.EditorState.push(g,i,"apply-entity")):F(g,"IMAGE",l),M(draftJs.EditorState.forceSelection(c,c.getCurrentContent().getSelectionAfter())),G("")):(a&&ne(),D())}:function(e){var t=u.urlKey,n,r,o,a,i,l,r;e?(n=g.getCurrentContent(),r=g,o={url:e,className:c.anchorLink},r=t?(n.replaceEntityData(t,o),draftJs.EditorState.push(g,n,"apply-entity")):(i=(a=n.createEntity("LINK","MUTABLE",o)).getLastCreatedEntityKey(),l=draftJs.EditorState.set(g,{currentContent:a}),draftJs.RichUtils.toggleLink(l,l.getSelection(),i)),M(r)):(t&&te(),D())}).apply(void 0,t)},isMedia:u.urlIsMedia}):null))},MUIRichTextEditor$1=styles$6.withStyles(styles$5,{withTheme:!0,name:"MUIRichTextEditor"})(React.forwardRef(MUIRichTextEditor));exports.default=MUIRichTextEditor$1;
